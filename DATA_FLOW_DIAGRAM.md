# Date-Based Data Flow Diagram

## Complete Flow: User Action â†’ API Request â†’ Dashboard Update

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          STREAMLIT DASHBOARD                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ“… SIDEBAR: Time Period Selection                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚   Today     â”‚  This Week   â”‚  This Month    â”‚ This Year    â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚                           â†“ User selects                           â”‚  â”‚
â”‚  â”‚                    "This Month" (selected)                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â†“                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  dashboard.py: load_data_by_period("month")                        â”‚  â”‚
â”‚  â”‚  â”œâ”€ Map to period: "month"                                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ Check cache: st.session_state["api_data_month"]               â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ If cached â†’ Return cached data                             â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ If not cached â†’ Continue to fetch                          â”‚  â”‚
â”‚  â”‚  â””â”€ Call: fetch_dashboard_data(period="month")                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â†“                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘     api_client.py (APIClient)     â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  get_sales_report(period="month")                                           â”‚
â”‚  â”œâ”€ period_code = "month"                                                   â”‚
â”‚  â”œâ”€ Call: get_date_range("month")                                           â”‚
â”‚  â”‚  â”œâ”€ today = datetime.now() = Jan 2, 2026                                 â”‚
â”‚  â”‚  â”œâ”€ Calculate:                                                           â”‚
â”‚  â”‚  â”‚  â”œâ”€ start_date = today.replace(day=1) = Jan 1, 2026                  â”‚
â”‚  â”‚  â”‚  â””â”€ end_date = today = Jan 2, 2026                                    â”‚
â”‚  â”‚  â”œâ”€ Format to DD-MM-YYYY:                                                â”‚
â”‚  â”‚  â”‚  â”œâ”€ "01-01-2026"                                                      â”‚
â”‚  â”‚  â”‚  â””â”€ "02-01-2026"                                                      â”‚
â”‚  â”‚  â””â”€ Return: ("01-01-2026", "02-01-2026")                                 â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â”œâ”€ Build request body:                                                     â”‚
â”‚  â”‚  {                                                                       â”‚
â”‚  â”‚    "action": "get_sales_report",                                         â”‚
â”‚  â”‚    "startdate": "01-01-2026",                                            â”‚
â”‚  â”‚    "enddate": "02-01-2026"                                               â”‚
â”‚  â”‚  }                                                                       â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â””â”€ POST to: https://avantemedicals.com/API/api.php?action=get_sales_report â”‚
â”‚                               â†“                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘      EXTERNAL API SERVER          â•‘
                    â•‘   avantemedicals.com/API/api.php  â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                         â”‚
    â”‚ Server receives:                                        â”‚
    â”‚ {                                                       â”‚
    â”‚   "action": "get_sales_report",                         â”‚
    â”‚   "startdate": "01-01-2026",    â† Filter by this       â”‚
    â”‚   "enddate": "02-01-2026"       â† and this             â”‚
    â”‚ }                                                       â”‚
    â”‚                                                         â”‚
    â”‚ âœ“ Queries database for transactions WHERE date         â”‚
    â”‚   BETWEEN 01-01-2026 AND 02-01-2026                    â”‚
    â”‚                                                         â”‚
    â”‚ Returns:                                                â”‚
    â”‚ {                                                       â”‚
    â”‚   "status": "success",                                  â”‚
    â”‚   "report_data": [                                      â”‚
    â”‚     {                                                   â”‚
    â”‚       "comp_nm": "Dealer A",                            â”‚
    â”‚       "city": "Delhi",                                  â”‚
    â”‚       "state": "Delhi",                                 â”‚
    â”‚       "SQ": 100,                                        â”‚
    â”‚       "SV": 50000                                       â”‚
    â”‚     },                                                  â”‚
    â”‚     { ... more records from this period ... }           â”‚
    â”‚   ]                                                     â”‚
    â”‚ }                                                       â”‚
    â”‚                                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘   Response back to Dashboard       â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  api_client.py: Process response                                         â”‚
â”‚  â”œâ”€ Extract records from response                                         â”‚
â”‚  â”œâ”€ Convert to pandas DataFrame                                           â”‚
â”‚  â”œâ”€ Rename columns (API format â†’ Dashboard format):                       â”‚
â”‚  â”‚  comp_nm â†’ Dealer Name                                                 â”‚
â”‚  â”‚  city â†’ City                                                           â”‚
â”‚  â”‚  SQ â†’ Qty                                                              â”‚
â”‚  â”‚  SV â†’ Value                                                            â”‚
â”‚  â”œâ”€ Convert numeric columns                                               â”‚
â”‚  â”œâ”€ Cache with key: "api_data_month"                                      â”‚
â”‚  â””â”€ Return DataFrame to dashboard.py                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  dashboard.py: Display metrics                                            â”‚
â”‚  â”œâ”€ current_period_label = "This Month"                                   â”‚
â”‚  â”œâ”€ current_period_data = df (all rows from selected month)               â”‚
â”‚  â”œâ”€ Calculate KPIs:                                                       â”‚
â”‚  â”‚  â”œâ”€ Revenue = SUM(Value) = Rs. X                                       â”‚
â”‚  â”‚  â”œâ”€ Quantity = SUM(Qty) = Y units                                      â”‚
â”‚  â”‚  â”œâ”€ Top Dealer = MODE(Dealer Name)                                     â”‚
â”‚  â”‚  â”œâ”€ Top State = MODE(State)                                            â”‚
â”‚  â”‚  â””â”€ etc...                                                             â”‚
â”‚  â”œâ”€ Display in metric boxes                                               â”‚
â”‚  â”œâ”€ Build charts with period data                                         â”‚
â”‚  â”œâ”€ Update tabs (Sales, Customer, Payment)                                â”‚
â”‚  â””â”€ Show label: "This Month" (Jan 1 - Jan 2, 2026)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘    USER SEES UPDATED DASHBOARD     â•‘
                    â•‘  with data filtered by period      â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Period Selection Examples

### Scenario 1: User selects "Today"
```
Current Time: Jan 2, 2026, 2:30 PM

Date Range: 02-01-2026 to 02-01-2026
Response: Only transactions from Jan 2, 2026
Display: "Today" label
```

### Scenario 2: User selects "This Week"
```
Current Time: Jan 2, 2026 (Thursday)
Week starts: Monday (Jan 1 is a Thursday? No - Dec 30, 2025 is Monday)

Actually: Jan 2, 2026 is a Thursday
So: Monday = Dec 30, 2025 (previous week!)

Date Range: 30-12-2025 to 02-01-2026
Response: Transactions from Mon Dec 30 through Thu Jan 2
Display: "This Week" (4 days of data)
```

### Scenario 3: User selects "This Month"
```
Current Time: Jan 2, 2026

Date Range: 01-01-2026 to 02-01-2026
Response: Transactions from Jan 1 through Jan 2
Display: "This Month" (first 2 days of Jan 2026)
```

### Scenario 4: User selects "This Year"
```
Current Time: Jan 2, 2026

Date Range: 01-01-2026 to 02-01-2026
Response: All transactions from Jan 1, 2026 through Jan 2, 2026
Display: "This Year" (since we're on Jan 2)
```

---

## Caching Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User switches to "This Month"      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Cache check:     â”‚
        â”‚ api_data_month?  â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
               â”‚       â”‚
          YES â”‚       â”‚ NO
             â†“        â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Use cached    â”‚  â”‚Fetch from API       â”‚
    â”‚data          â”‚  â”‚â”œâ”€ Send date range   â”‚
    â”‚â”œâ”€Instant     â”‚  â”‚â”œâ”€ Process response  â”‚
    â”‚â””â”€No API call â”‚  â”‚â”œâ”€ Convert to DF     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â””â”€ Cache result      â”‚
             â”‚        â”‚                     â”‚
             â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                  â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Display metrics â”‚
                 â”‚ & charts        â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Request-Response Cycle

```
DASHBOARD                        API_CLIENT                    EXTERNAL API
    â”‚                               â”‚                              â”‚
    â”œâ”€ User selects period â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’                              â”‚
    â”‚                               â”œâ”€ Calculate dates             â”‚
    â”‚                               â”œâ”€ Build request body          â”‚
    â”‚                               â”œâ”€ POST request â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
    â”‚                               â”‚                    Process
    â”‚                               â”‚                    & filter
    â”‚                               â”‚                    dates
    â”‚                               â”‚â†â”€ JSON response â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚                               â”œâ”€ Parse JSON
    â”‚                               â”œâ”€ Convert to DataFrame
    â”‚                               â”œâ”€ Rename columns
    â”‚â†â”€ Return DataFrame â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”œâ”€ Display metrics             â”‚
    â”œâ”€ Update charts               â”‚
    â”œâ”€ Show period label           â”‚
    â”‚                               â”‚
```

---

## Key Points

1. **Dates sent to API:** DD-MM-YYYY format only
2. **Server-side filtering:** API handles date filtering
3. **Client-side usage:** Dashboard uses all returned data (already filtered)
4. **Caching:** Each period cached separately
5. **Instant switching:** Cached data loads instantly
6. **Auto-refresh:** Click "Refresh" to clear caches

---

## Testing Dates Today: January 2, 2026

| Period | Start Date | End Date | What it covers |
|--------|-----------|----------|----------------|
| Today | 02-01-2026 | 02-01-2026 | Just today |
| This Week | 30-12-2025 | 02-01-2026 | Mon-Thu (4 days) |
| This Month | 01-01-2026 | 02-01-2026 | Jan 1-2 |
| This Year | 01-01-2026 | 02-01-2026 | Jan 1-2 |
